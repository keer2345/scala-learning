
# Foreword

在 1814 年，Pierre-Simon Laplace 写道：“人生最重要的问题是，大多数情况下，只是概率问题”。一百多年过去了，回答这些问题的唯一方式（保持真理的同时）是用纸和笔分析问题，结果获得公式，并通过手工带入数字来评估公式。计算机的出现并没有改变太多，它只是意味着更多的公式得意评估，通过更多的数字，并且分析变得更加雄心勃勃，通常延伸到数百页。

概率问题的分析需要制定概率模型（**probability model**），列出可能的空间，以某种方式给他们都分配概率数值。在过去，概率模型使用自然语言文本和办正式的数学符号书写。从模型、公式和计算算法的答案进一步推导出数学操作。每个阶段都是艰苦的，有误差的，有特定问题的，严重的限制了概率理论的实用性。尽管如此，人生的重要问题仍然是无法作答的。

第一个重要的步骤是正式语言（formal languages）的发展。Bayesian 和 Markov 网络的正式语言，事实上在表达能力上相当有限。在某种意义上，他们的概率模拟逻辑电路。为了了解有什么限制，可以考虑为大公司编写工资软件。在类似 Java 的高阶语言，可能设计成千上万行的代码。现在，设想一下实现将布尔门连接起来的功能，这个任务看起来不能完成，电路难以想象的大，复杂和不透明，因为电路缺乏表达能力来捕获问题的结构。

在 1997 年，本书的作者 Avi Pfeffer，和他的一个学生，还有他的顾问 Daphne Koller，以及合作者David McAllester，发表了开创新的概率编程语言（Probabilistic Programming Languages (PPLs)）的论文，提供的关键的理论把概率论和高级编程语言关联起来。其思想是通过引入随机元素并将程序的含义定义为每个可能执行跟踪的概率，从而使程序成为概率模型。这一想法试图以一种有效的方式连接两个最重要的数学分支，我们刚刚开始探索新的可能性出现了。

本书试图让读者使用 Figaro 语言实现这些想法，并描述这些概念和应用。它能避免数学并集中于现实示例，带有详细的解释。它适用于有一定编程背景的人员。通过阅读本书，读者将花费更少的努力来获取贝叶斯定理和统计学的原则和技术。或者更重要的是，读者将学习建模技巧，这是科学家或者工程师应用有的最关键的技术。Figaro 和其他的 PPLs 允许直接、快速并精准地表达技巧。

本书是将概率编程从开发它的实验室中应用到实践的重要一步。PPL 系统的能力无可置疑，但是在某些方面无法满足挑战，并且这些研究实验室将终止其工作。另一方面，本书的读者无疑会找出创造性的方式应用 Figaro，以及作者没有想到的其他更广泛的新问题。

<div align="right">
STUART RUSSELL ，计算机科学教授，加州大学伯克利分校
</div>

# Preface

概率编程是一门令人兴奋的新领域，从学术舞台到程序员的真实世界。本质上，概率编程以一种新的方式为概率推理创建模型，让你从观察到的东西预测或推断出未知的东西。概率推理一直是机器学习的核心方法之一，用概率推理来描述已知事物并从经验中学习。在概率编程之前，概率推理系统仅限于简单模型和类似 Bayesian 网络的固定结构。概率编程使得概率推理系统拜托束缚并提供编程语言的强大力量来表示模型。这类似从电路到高级程序语言。

虽然我那时没意识到，我年轻时一直从事概率编程工作，当时使用 BASIC 开发足球模拟器。这个模拟器使用类似 `GOTO 1730 + RANDOM * 5` 表示随机事件的顺序。经过调整时候，模拟器足以让我开心几个小时。当然，在这期间，概率编程从 `GOTO` 到随机目标已经成熟许久了。

在 1997 年，我的合作者 Daphne Koller 和 David McAllester 发表了第一篇概率编程论文，论文介绍了 Lisp-like 概率语言，但论文的主要创新是推理出基于证据推断程序方面可能的算法。这一创新使得概率编程超过典型的概率仿真语言，不仅意味着运行程序前或者可能的执行，而且向后推理并推断出产生观察结果的原因。

在 2000 年早期，我开发了 IBAL （发音 eyeball），这是第一个通用的基于函数编程的概率编程语言。IBAL 高度表达包含小说推理的算法，几年后我逐渐不满于它的限制，其中最主要的困难是数据交互和集成应用。在 2009 年，这些限制促使我开发了新的概率编程系统—— Figaro 。Figaro 以实用为首要目标，并且不牺牲概率编程的力量。这导致了 Figaro 作为一个 Scala 库来实现，其很容易集成概率编程到 Java 虚拟机应用中。同时，Figaro 尽可能广泛的代表我所知道的其他概率编程系统的特性和推理算法。Figaro 在 [Github](https://github.com/p2t2/figaro) 上已经是 3.3（实际上翻译本书的时候已经是 4.1） 版本了。

概率编程作为有挑战的技术主要是它需要多种技能，主要是编写概率模型和编写程序的能力，许多程序员天生会写程序，但概率模型则有一些神秘。本书就是让概率模型的神秘面纱通过程序有效地展示出来，并帮助你有效地使用概率编程系统。本书假定没有机器学习和概率推理的背景。一些函数编程和 Scala 经验是有益的，但你不必是一个 Scala 高手，你的 Scala 经验可能有助于阅读。

读完此书后，应该可以为许多应用设计概率模型以从你的数据中获取有意义的信息，并不需要机器学习中的 PhD。如果你专注于某一领域，本书将有助于你在脑海中或者纸上表达模型并操作它们，你能够评估和分析不同的可能。如果你是一个数据科学家，本书能帮你的发展更丰富、详细并比其他工具更为准确。如果你是一个软件工程师或者建筑师，想将不确定的推理融入你的系统，本书不仅有助于构建模型来处理不确定性，而且在应用中整合模型。不管你拿起这本书是何原因，我系统你喜欢它，并觉得有用。

# Acknowledgements
这本书写了很多年，从概率编程的第一个想法到 IBAL 和 Figaro 的构思，再到在 Manning 的出版，无数人多年来贡献他们的努力使得这本书成为可能。

